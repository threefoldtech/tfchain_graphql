module.exports = class denormalize_data1694605589133 {
    name = 'denormalize_data1694605589133'

    async up(db) {
        await db.query(`CREATE TABLE "contract" ("id" character varying NOT NULL, "grid_version" integer NOT NULL, "contract_id" numeric NOT NULL, "twin_id" integer NOT NULL, "node_id" integer, "deployment_data" text, "deployment_hash" text, "number_of_public_i_ps" integer, "state" character varying(11) NOT NULL, "created_at" numeric NOT NULL, "solution_provider_id" integer, "used_cru" numeric, "used_mru" numeric, "used_sru" numeric, "used_hru" numeric, "name" text, "type" character varying(4) NOT NULL, CONSTRAINT "PK_17c3a89f58a2997276084e706e8" PRIMARY KEY ("id"))`)
        await db.query(`CREATE INDEX "IDX_2f25fae55a3bd80337501b310e" ON "contract" ("contract_id") `)
        await db.query(`CREATE INDEX "IDX_e9713e5dd661bc93d698d725e8" ON "contract" ("state") `)
        await db.query(`CREATE INDEX "IDX_59d5a7aca69d7ea58c101a44c6" ON "contract" ("type") `)
        await db.query(`ALTER TABLE "farm" ADD "total_ips" integer NOT NULL`)
        await db.query(`ALTER TABLE "farm" ADD "free_ips" integer NOT NULL`)
        await db.query(`ALTER TABLE "node" ADD "total_cru" numeric NOT NULL`)
        await db.query(`ALTER TABLE "node" ADD "total_hru" numeric NOT NULL`)
        await db.query(`ALTER TABLE "node" ADD "total_sru" numeric NOT NULL`)
        await db.query(`ALTER TABLE "node" ADD "total_mru" numeric NOT NULL`)
        await db.query(`ALTER TABLE "node" ADD "free_mru" numeric NOT NULL`)
        await db.query(`ALTER TABLE "node" ADD "free_hru" numeric NOT NULL`)
        await db.query(`ALTER TABLE "node" ADD "free_sru" numeric NOT NULL`)
        await db.query(`ALTER TABLE "node" ADD "rented_by" integer`)
        await db.query(`ALTER TABLE "public_ip" ALTER COLUMN "contract_id" DROP NOT NULL`)
        await db.query(`CREATE INDEX "IDX_a162f043823849732649d40627" ON "twin" ("twin_id") `)
        await db.query(`CREATE INDEX "IDX_5f29012fe3403c0cf194457ecd" ON "public_ip" ("contract_id") `)
        await db.query(`CREATE INDEX "IDX_a09d726d0ff006b47ff4d25428" ON "farm" ("farm_id") `)
        await db.query(`CREATE INDEX "IDX_e6523793483b172e422dc225ad" ON "node" ("node_id") `)
        await db.query(`CREATE INDEX "IDX_4d4375648edaa07add3df9d876" ON "node" ("free_mru") `)
        await db.query(`CREATE INDEX "IDX_b6ff61e1f0b66b70374d1168d4" ON "node" ("free_hru") `)
        await db.query(`CREATE INDEX "IDX_1d93b5617168669d707d52077d" ON "node" ("free_sru") `)
        await db.query(`CREATE INDEX "IDX_23c232066e25d61f3a703b1c08" ON "contract_bill_report" ("contract_id") `)
        await db.query(`DROP TABLE "rent_contract"`)
        await db.query(`DROP TABLE "name_contract"`)
        await db.query(`DROP TABLE "contract_resources" cascade`)
        await db.query(`DROP TABLE "node_contract" cascade`)
    }

    async down(db) {
        await db.query(`DROP TABLE "contract"`)
        await db.query(`DROP INDEX "public"."IDX_2f25fae55a3bd80337501b310e"`)
        await db.query(`DROP INDEX "public"."IDX_e9713e5dd661bc93d698d725e8"`)
        await db.query(`DROP INDEX "public"."IDX_59d5a7aca69d7ea58c101a44c6"`)
        await db.query(`ALTER TABLE "farm" DROP COLUMN "total_ips"`)
        await db.query(`ALTER TABLE "farm" DROP COLUMN "free_ips"`)
        await db.query(`ALTER TABLE "node" DROP COLUMN "total_cru"`)
        await db.query(`ALTER TABLE "node" DROP COLUMN "total_hru"`)
        await db.query(`ALTER TABLE "node" DROP COLUMN "total_sru"`)
        await db.query(`ALTER TABLE "node" DROP COLUMN "total_mru"`)
        await db.query(`ALTER TABLE "node" DROP COLUMN "free_mru"`)
        await db.query(`ALTER TABLE "node" DROP COLUMN "free_hru"`)
        await db.query(`ALTER TABLE "node" DROP COLUMN "free_sru"`)
        await db.query(`ALTER TABLE "node" DROP COLUMN "rented_by"`)
        await db.query(`ALTER TABLE "public_ip" ALTER COLUMN "contract_id" SET NOT NULL`)
        await db.query(`DROP INDEX "public"."IDX_a162f043823849732649d40627"`)
        await db.query(`DROP INDEX "public"."IDX_5f29012fe3403c0cf194457ecd"`)
        await db.query(`DROP INDEX "public"."IDX_a09d726d0ff006b47ff4d25428"`)
        await db.query(`DROP INDEX "public"."IDX_e6523793483b172e422dc225ad"`)
        await db.query(`DROP INDEX "public"."IDX_4d4375648edaa07add3df9d876"`)
        await db.query(`DROP INDEX "public"."IDX_b6ff61e1f0b66b70374d1168d4"`)
        await db.query(`DROP INDEX "public"."IDX_1d93b5617168669d707d52077d"`)
        await db.query(`DROP INDEX "public"."IDX_23c232066e25d61f3a703b1c08"`)
        await db.query(`CREATE TABLE "node_contract" ("id" character varying NOT NULL, "grid_version" integer NOT NULL, "contract_id" numeric NOT NULL, "twin_id" integer NOT NULL, "node_id" integer NOT NULL, "deployment_data" text NOT NULL, "deployment_hash" text NOT NULL, "number_of_public_i_ps" integer NOT NULL, "state" character varying(11) NOT NULL, "created_at" numeric NOT NULL, "resources_used_id" character varying, "solution_provider_id" integer, CONSTRAINT "PK_a5f90b17f504ffcd79d1f66574a" PRIMARY KEY ("id"))`)
        await db.query(`ALTER TABLE "node_contract" ADD CONSTRAINT "FK_f294cfb50bb7c7b976d86c08fda" FOREIGN KEY ("resources_used_id") REFERENCES "contract_resources"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`)
        await db.query(`CREATE TABLE "rent_contract" ("id" character varying NOT NULL, "grid_version" integer NOT NULL, "contract_id" numeric NOT NULL, "twin_id" integer NOT NULL, "node_id" integer NOT NULL, "state" character varying(11) NOT NULL, "created_at" numeric NOT NULL, "solution_provider_id" integer, CONSTRAINT "PK_3c99766b627604d5950d704e33a" PRIMARY KEY ("id"))`)
        await db.query(`CREATE TABLE "name_contract" ("id" character varying NOT NULL, "grid_version" integer NOT NULL, "contract_id" numeric NOT NULL, "twin_id" integer NOT NULL, "name" text NOT NULL, "state" character varying(11) NOT NULL, "created_at" numeric NOT NULL, "solution_provider_id" integer, CONSTRAINT "PK_7b4cd056bbb83602d211996360f" PRIMARY KEY ("id"))`)
        await db.query(`CREATE TABLE "contract_resources" ("id" character varying NOT NULL, "hru" numeric NOT NULL, "sru" numeric NOT NULL, "cru" numeric NOT NULL, "mru" numeric NOT NULL, "contract_id" character varying, CONSTRAINT "PK_557de19994fcca90916e8c6582f" PRIMARY KEY ("id"))`)
        await db.query(`ALTER TABLE "contract_resources" ADD CONSTRAINT "FK_621238dffde9099b2233650235d" FOREIGN KEY ("contract_id") REFERENCES "node_contract"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`)
    }
}
